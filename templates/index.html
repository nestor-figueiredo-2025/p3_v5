<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel/Totem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container my-4">
    <h1 class="text-center mb-4">Painel/Totem</h1>

    <form method="get" action="{{ url_for('index') }}" class="row g-2 mb-4 align-items-end">
        <div class="col-md-3">
            <label for="search" class="form-label">Buscar por Nome:</label>
            <input type="text" name="search" id="search" class="form-control" placeholder="Digite o nome" value="{{ request.args.get('search', '') }}">
        </div>
        <div class="col-md-2">
            <label for="sort_by" class="form-label">Ordenar por:</label>
            <select name="sort_by" id="sort_by" class="form-select">
                <option value="titulo" {% if sort_by == 'titulo' %}selected{% endif %}>Título</option>
                <option value="bloco" {% if sort_by == 'bloco' %}selected{% endif %}>Bloco</option>
                <option value="nome" {% if sort_by == 'nome' %}selected{% endif %}>Nome</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="monitorado" class="form-label">Monitorado:</label>
            <select name="monitorado" id="monitorado" class="form-select">
                <option value="" {% if request.args.get('monitorado', '') == '' %}selected{% endif %}>Todos</option>
                <option value="sim" {% if request.args.get('monitorado') == 'sim' %}selected{% endif %}>Sim</option>
                <option value="nao" {% if request.args.get('monitorado') == 'nao' %}selected{% endif %}>Não</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="ativo" class="form-label">Ativo:</label>
            <select name="ativo" id="ativo" class="form-select">
                <option value="" {% if request.args.get('ativo', '') == '' %}selected{% endif %}>Todos</option>
                <option value="sim" {% if request.args.get('ativo') == 'sim' %}selected{% endif %}>Sim</option>
                <option value="nao" {% if request.args.get('ativo') == 'nao' %}selected{% endif %}>Não</option>
            </select>
        </div>
        <div class="col-md-2 d-flex gap-2">
            <button type="submit" class="btn btn-secondary w-100">Aplicar</button>
            {% if session.get('user_tipo') == 'adm' %}
                <a href="{{ url_for('adicionar') }}" class="btn btn-success w-100">Inserir Registro</a>
            {% endif %}
        </div>
    </form>

    <div class="row mb-3">
        <div class="col-md-6 d-flex align-items-center">
            <form action="{{ url_for('logout') }}" method="post" class="mb-0 me-2">
                <button type="submit" class="btn btn-outline-danger btn-sm">Sair</button>
            </form>
            <a href="{{ url_for('execution_log_viewer') }}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-journal-text"></i> Visualizar Logs
            </a>
            {% if session.get('user_tipo') == 'adm' %}
                <a href="{{ url_for('usuarios') }}" class="btn btn-dark btn-sm me-2">Gerenciar Usuários</a>
                {% if session.get('user_tipo') == 'adm' %}
                    <!-- Botões de ação aqui -->
                {% endif %}
            {% endif %}
        </div>
        <div class="col-md-6 text-end">
            <h2 style="font-size: 1.1rem; margin: 0; display: inline-block;">
                Total de Registros: {{ records|length }}
            </h2>
        </div>
    </div>

    {% if error %}
        <div class="alert alert-danger text-center my-3" role="alert">
            {{ error }}<br>
            Caso o problema persista, entre em contato com o administrador do sistema.
        </div>
    {% endif %}

    {% if show_welcome %}
    <div class="alert alert-success text-center">
        Bem-vindo de volta, {{ session['user'] }}!
    </div>
    {% endif %}

    <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th {% if sort_by == 'titulo' %}style="color: yellow;"{% endif %}>Título</th>
                    <th {% if sort_by == 'nome' %}style="color: yellow;"{% endif %}>Nome</th>
                    <th {% if sort_by == 'tipo' %}style="color: yellow;"{% endif %}>Tipo</th>
                    <th {% if sort_by == 'bloco' %}style="color: yellow;"{% endif %}>Bloco</th>
                    <th {% if sort_by == 'andar' %}style="color: yellow;"{% endif %}>Andar</th>
                    <th {% if sort_by == 'ativo' %}style="color: yellow;"{% endif %}>Ativo</th>
                    <th {% if sort_by == 'monitorado' %}style="color: yellow;"{% endif %}>Mon</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for record in records %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ record.titulo }}</td>
                    <td>{{ record.nome }}</td>
                    <td>{{ record.tipo }}</td>
                    <td>{{ record.bloco }}</td>
                    <td>{{ record.andar }}</td>
                    <td>{{ 'Sim' if record.ativo else 'Não' }}</td>
                    <td>{{ 'Sim' if record.monitorado else 'Não' }}</td>
                    <td>
                        {% if session.get('user_tipo') == 'adm' %}
                            <form action="/delete/{{ record.titulo }}" method="post" class="d-inline me-1">
                                <button type="submit" class="btn btn-danger btn-sm">Excluir</button>
                            </form>
                            <a href="/edit/{{ record.titulo }}" class="btn btn-secondary btn-sm me-1">Editar</a>
                            <form action="/toggle_monitorado/{{ record.titulo }}" method="post" class="d-inline">
                                <button type="submit"
                                        class="btn btn-sm {% if record.monitorado %}btn-success{% else %}btn-warning{% endif %}">
                                    {{ 'Mon_N' if record.monitorado else 'Mon_S' }}
                                </button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>